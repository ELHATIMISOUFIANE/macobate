---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import AppointmentForm from "../../components/AppointmentForm.astro";
import CallToActionSection from "../../components/CallToActionSection.astro";

const services = [
  {
    id: "steel-construction",
    title: "Steel Construction",
    description: `
      <p>At MACOBATE, we design and build steel structures with a combination of engineering excellence, manufacturing precision, and site assembly expertise. Our solutions cover industrial buildings, pipe racks, platforms, support frames, and architectural structures.</p>
      
      <p>What we deliver:</p>
      <ul>
        <li><strong>Heavy-duty steel buildings</strong></li>
        <li><strong>Industrial pipe racks and equipment supports</strong></li>
        <li><strong>Walkways, stair towers, and platforms</strong></li>
        <li><strong>Pre-engineered buildings (PEB) and modular units</strong></li>
        <li><strong>Bridges and access gantries</strong></li>
      </ul>
      
      <p>Our integrated capabilities include:</p>
      <ol>
        <li>3D modeling (Tekla Structures)</li>
        <li>Structural analysis (Robot Structural Analysis)</li>
        <li>Automated cutting, drilling, welding and painting</li>
        <li>Manufacturing under ISO 9001 and EN 1090-2 EXC2/3 certification</li>
        <li>Workshop drawings, traceability and on-site assembly</li>
      </ol>
      
      <p>Our teams ensure end-to-end project support: from workshop drawings and traceability to delivery, on-site erection, and turnkey handover. Our logistics and installation crews operate under controlled safety and quality protocols.</p>
    `,
    image: "/images/gallery/charpente-metallique.jpg",
    features: [
      "Integrated engineering & manufacturing",
      "Large-scale fabrication facilities",
      "Certified welding and quality control",
      "Competitive lead times and cost efficiency",
      "References in water, energy, industry and public infrastructure",
    ],
  },
  {
    id: "pressure-vessels",
    title: "Pressure Vessels",
    description: `
      <p>At MACOBATE, we design and manufacture large and heavy-duty pressure vessels in full compliance with internationally recognized codes, including CODAP and ASME Section VIII. Our solutions are engineered to withstand extreme conditions and serve the most demanding industries.</p>
      
      <p>Our Engineering Department leverages advanced design and simulation software (PV Elite, AutoPIPE, SolidWorks, etc.) to ensure full conformity with construction codes. All pressure vessels are subjected to rigorous mechanical, thermal, and stress analysis before production.</p>
      
      <p>With decades of experience, our skilled technicians and certified welders manufacture:</p>
      <ul>
        <li><strong>Thick-walled pressure vessels</strong> up to 50mm forming capacity</li>
        <li><strong>Units in carbon steel, stainless steel, duplex and other alloys</strong></li>
        <li><strong>Equipment tailored</strong> for oil & gas, chemical, energy, and water industries</li>
      </ul>
      
      <p>We also specialize in custom-engineered process equipment such as:</p>
      <ul>
        <li>Reactors</li>
        <li>Filters and separators</li>
        <li>Heat exchangers</li>
        <li>Skid-mounted units</li>
      </ul>
      
      <p>Each project is developed with strict attention to process requirements, quality control, and international standards.</p>
    `,
    image: "/images/gallery/appareil-pression.jpeg",
    features: [
      "Certified fabrication under EN ISO 3834-2, EN 13445 and ASME",
      "Full traceability and documentation",
      "Turnkey project support from design to site delivery",
      "Industrial-scale infrastructure",
      "Capability to work with various materials and alloys",
    ],
  },
  {
    id: "storage-tanks",
    title: "Storage Tanks",
    description: `
      <p>At MACOBATE, we design and build all types of steel storage tanks for various industries, in full compliance with international standards such as API 650, API 620, and the French CODRES code.</p>
      
      <p>Thanks to our fully automated hydraulic jacking system, we can erect and weld large-diameter storage tanks safely and efficiently, even in time-constrained projects.</p>
      
      <p>We deliver tailor-made tanks for:</p>
      <ul>
        <li><strong>Water storage</strong></li>
        <li><strong>Oil & gas</strong></li>
        <li><strong>Chemical processing</strong></li>
        <li><strong>Food and beverage</strong></li>
      </ul>
      
      <p>We use suitable materials: carbon steel, stainless steel, or specific coatings depending on the client's technical requirements.</p>
      
      <p>Our expertise includes both field-erected and workshop-built tanks, with integrated engineering and manufacturing and rigorous quality control (NDT, hydrotests, weld qualification).</p>
    `,
    image: "/images/gallery/reservoirs.png",
    features: [
      "Expertise in field-erected and workshop-built tanks",
      "Integrated engineering and fabrication",
      "Strict quality control (NDT, hydrotests, weld qualification)",
      "Fast and safe construction",
      "Solutions for various industrial sectors",
    ],
  },
  {
    id: "hydromechanical-equipment",
    title: "Hydromechanical Equipment",
    description: `
      <p>At MACOBATE, hydromechanical equipment is more than expertise—it's a passion rooted in generations of engineering heritage. By mastering the secrets of design and fabrication in this highly specialized field, MACOBATE has developed advanced multidisciplinary skills across:</p>
      <ul>
        <li>Mechanical engineering</li>
        <li>Hydraulics</li>
        <li>Electrical systems</li>
        <li>Automation</li>
      </ul>
      
      <p>MACOBATE is undeniably the leading reference in Morocco for hydromechanical equipment. Our proven track record includes dozens of major water dams and hydropower plants, delivered in partnership with national and international stakeholders.</p>
      
      <p>Our wide-ranging hydromechanical solutions include:</p>
      <ul>
        <li><strong>Penstocks, steel linings, transitions and bifurcations</strong></li>
        <li><strong>Radial gates</strong></li>
        <li><strong>Wheel gates</strong></li>
        <li><strong>Sluice gates</strong></li>
        <li><strong>Butterfly valves</strong></li>
        <li><strong>Trashracks and intake screens</strong></li>
      </ul>
      
      <p>Whether you need individual equipment or a fully integrated turnkey system, MACOBATE is your winning card for challenging and high-performance water infrastructure projects.</p>
      
      <p>Major references include:</p>
      <ul>
        <li>Oued El Makhazine Dam</li>
        <li>Al Massira Dam</li>
        <li>Lalla Takerkoust Dam</li>
        <li>Multiple hydropower stations in collaboration with ONEE</li>
        <li>Export contracts in West Africa</li>
      </ul>
    `,
    image: "/images/gallery/equipements-hydromecaniques.jpeg",
    features: [
      "A heritage of precision and passion",
      "National leader in water infrastructure",
      "Multidisciplinary expertise",
      "Solutions from components to turnkey systems",
      "Numerous references on major projects",
    ],
  },
  {
    id: "turnkey-projects",
    title: "Turnkey Projects",
    description: `
      <p>Our multidisciplinary engineering and manufacturing capabilities represent our best asset and major competitive advantage.</p>
      
      <p>By choosing MACOBATE, not only do you team up with a project builder but with a field expert who brings real added value in:</p>
      <ul>
        <li><strong>Technical solutions</strong></li>
        <li><strong>Cost savings</strong></li>
        <li><strong>Project management</strong></li>
        <li><strong>Schedule optimization</strong></li>
      </ul>
      
      <p>We can offer turnkey projects from design to operation including all scopes such as:</p>
      <ul>
        <li>Engineering & mechanical design</li>
        <li>Manufacturing & steel construction</li>
        <li>Installation</li>
        <li>Electrical and automation</li>
      </ul>
      
      <p>Our quality and safety-driven culture makes us a trusted operator on the market:</p>
      <ul>
        <li>ISO 9001, ISO 3834, EN 1090, ISO 45001, ISO 14001</li>
        <li>Weld qualifications, NDT, ITPs, FATs</li>
        <li>Strict HSE plans and site supervision</li>
      </ul>
      
      <p>We continue with a clear target in mind: to show the way ahead for a whole continent at the verge of the next industrial rise.</p>
      
      <p>With over 40 years of EPC excellence, we have delivered hundreds of significant turnkey projects in various sectors: dams and pumping stations, water treatment and energy units, industrial steel plants and piping networks for various clients such as ONEE, ministerial departments, industrial groups, and export projects.</p>
    `,
    image: "/images/gallery/projets-cle-en-main.jfif",
    features: [
      "Our multidisciplinary advantage",
      "More than a builder - a field expert",
      "Complete turnkey offering",
      "Quality and safety culture",
      "Over 40 years of EPC excellence",
    ],
  },
  {
    id: "water-treatment",
    title: "Water Treatment",
    description: `
      <p>Founded by Ing. M'hamed TOUNSI, a renowned water treatment expert, MACOBATE began its industrial journey by participating in major water treatment projects.</p>
      
      <p>Since the early nineties, MACOBATE has been developing its own range of mobile water treatment plants adapted to several types of water quality:</p>
      <ul>
        <li><strong>Potable water</strong></li>
        <li><strong>Desalination</strong></li>
        <li><strong>Wastewater</strong></li>
      </ul>
      
      <p>Today, through our registered brand MWS, we offer ready-to-go treatment plants that can be installed in series to reach the required flow rates.</p>
      
      <p>These solutions are:</p>
      <ul>
        <li>Designed for extreme environments</li>
        <li>Require little to no maintenance</li>
        <li>Highly automated and remotely controlled</li>
      </ul>
      
      <p>You can monitor and control your treatment plant directly from your smartphone, for flexible and efficient operation.</p>
      
      <p>At MACOBATE, we believe that technological advances must serve the universal need for water access — transforming this rare resource into shared abundance.</p>
      
      <p>Reference projects include:</p>
      <ul>
        <li>Mobile units for rural areas</li>
        <li>Emergency systems for drought relief</li>
        <li>Pilot plants for desalination and reuse</li>
        <li>Custom MWS modules for industrial clients</li>
      </ul>
    `,
    image: "/images/gallery/traitement-eau.jpg",
    features: [
      "Mobile and innovative solutions since the 90s",
      "MWS ready-to-use technology",
      "Plug & Play performance",
      "Smart and connected stations",
      "Proven field experience",
    ],
  },
  {
    id: "electricity-automation",
    title: "Electricity & Automation",
    description: `
      <p>At MACOBATE, electricity and automation are not just support disciplines — they are strategic performance drivers. We integrate smart electrical systems and automation into all our equipment and projects to ensure reliability, energy efficiency, and complete control.</p>

      <p>Each industrial site requires operation, monitoring, and control. At MACOBATE, we deliver turnkey installations including:</p>
      <ul>
        <li><strong>HV and MV power supply</strong></li>
        <li><strong>Low voltage electrical panels</strong></li>
        <li><strong>Hydraulic power units and actuators</strong></li>
        <li><strong>Measuring instruments and sensors</strong></li>
        <li><strong>Automation</strong>: PLC programming, SCADA systems, Human Machine Interfaces (HMI)</li>
        <li><strong>Instrumentation</strong>: Sensors, actuators, transmitters for precise process control</li>
        <li><strong>Industrial electricity</strong>: Electrical network installation, wiring, earthing</li>
        <li><strong>Variable speed drives</strong>: Motor drive systems with energy optimization</li>
      </ul> 

      <p>Our automation systems provide concrete benefits:</p>
      <ul>
        <li>Precise control of industrial processes</li>
        <li>Energy optimization and consumption reduction</li>
        <li>Remote monitoring and predictive maintenance</li>
        <li>Traceability and data acquisition</li>
        <li>Scalability and adaptability to future needs</li>
      </ul>

      <p>Faithful to our engineering philosophy, we ensure 100% of the scope: Process and detailed design, equipment selection, assembly, workshop testing, site wiring, commissioning, training and operational support.</p>

      <p>We also integrate solar systems, backup generators, and indoor/outdoor lighting, even in severe ATEX environments.</p>

      <p>Our experience on varied and complex industrial projects makes MACOBATE your best ally for custom and high-performance electrical and automation systems.</p>
    `,
    image: "/images/gallery/electricite-automatismes.jpg",
    features: [
      "In-house specialized electrical & automation team",
      "Complete integration: design, wiring, commissioning",
      "Proven field experience",
      "ATEX, IEC, CE standards compliance",
      "Reliability, durability and control autonomy",
    ],
  },
];

// Service IDs list for verification
const serviceIds = services.map((service) => service.id);
---

<BaseLayout title="Our Services - MACOBATE">
  <Header />
  <main>
    <!-- Page Title -->
    <section
      class="page-title"
      style="background-image:url(/images/background/6.jpg);
      filter: brightness(1.5)"
    >
      <div class="auto-container">
        <ul class="page-breadcrumb" aria-label="Breadcrumb">
          <li><a href="/">Home</a></li>
          <li><a href="/services/allServices">Services</a></li>
          <li>Our Services</li>
        </ul>
        <h1>Our Services</h1>
      </div>
    </section>

    <!-- Services Section -->
    <section class="services-detail-section" id="services-main-section">
      <div class="auto-container">
        <div class="row clearfix">
          <!-- Sidebar Services Menu -->
          <div class="sidebar-column col-lg-3 col-md-4 col-sm-12">
            <div class="inner-column">
              <div class="services-list">
                <h3>All our services</h3>
                <ul aria-label="Services list">
                  {
                    services.map((service) => (
                      <li id={`menu-item-${service.id}`}>
                        <a
                          href={`#${service.id}`}
                          class="service-link"
                          data-service-id={service.id}
                        >
                          {service.title}
                        </a>
                      </li>
                    ))
                  }
                </ul>
              </div>

              <div class="help-box">
                <h4>Need help?</h4>
                <p>Our sales team is available to study your project.</p>
                <a href="/formDevis" class="theme-btn btn-style-one">
                  Request a quote <span
                    class="icon flaticon-arrow-pointing-to-right"></span>
                </a>
              </div>
            </div>
          </div>

          <!-- Service Content Column -->
          <div class="content-column col-lg-9 col-md-8 col-sm-12" id="content-area">
            <div class="inner-column">
              {
                services.map((service, index) => (
                  <div id={service.id} class="service-detail">
                    <div class="service-header">
                      <h2 class="service-title">{service.title}</h2>
                      {service.id === "steel-construction" && (
                        <p class="service-slogan">
                          Engineered Steel Structures
                        </p>
                      )}
                      {service.id === "pressure-vessels" && (
                        <p class="service-slogan">
                          Engineered for pressure. Built for performance.
                        </p>
                      )}
                      {service.id === "storage-tanks" && (
                        <p class="service-slogan">
                          Comprehensive steel tank solutions for every industry.
                        </p>
                      )}
                      {service.id === "hydromechanical-equipment" && (
                        <p class="service-slogan">
                          Engineered with legacy. Built for performance.
                        </p>
                      )}
                      {service.id === "water-treatment" && (
                        <p class="service-slogan">
                          Technology for Water. Engineering for Life.
                        </p>
                      )}
                      {service.id === "electricity-automation" && (
                        <p class="service-slogan">
                          We Pulse Life to Your Projects
                        </p>
                      )}
                      {service.id === "turnkey-projects" && (
                        <p class="service-slogan">We Build What We Design.</p>
                      )}
                      <div class="separator" />
                    </div>

                    <div class="service-image">
                      <img
                        src={service.image}
                        alt={`Illustration of ${service.title} service`}
                        class="img-fluid"
                      />
                    </div>

                    <div class="text-content" set:html={service.description} />

                    <div class="features-box">
                      <h3>Key points of our service</h3>
                      <div class="features-list">
                        {service.features.map((feature) => (
                          <div class="feature-item">
                            <span
                              class="icon flaticon-tick"
                              aria-hidden="true"
                            />
                            <span class="feature-text">{feature}</span>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div class="action-box">
                      <a
                        href="#"
                        class="theme-btn btn-style-one"
                        data-toggle="modal"
                        data-target="#schedule-box"
                      >
                        Request a quote for this service
                        <span
                          class="icon flaticon-arrow-pointing-to-right"
                          aria-hidden="true"
                        />
                      </a>
                    </div>
                  </div>
                ))
              }
            </div>
          </div>
        </div>
      </div>
    </section>

    <CallToActionSection />
    <AppointmentForm />
  </main>
  <Footer />
</BaseLayout>

<style>
  html {
    scroll-behavior: smooth;
  }

  /* Styles for service detail section */
  .services-detail-section {
    padding: 80px 0;
    background-color: #f8f9fa;
  }

  /* Styles for services list in sidebar */
  .services-list {
    background-color: white;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    padding: 25px;
    margin-bottom: 30px;
  }

  .services-list h3 {
    font-size: 20px;
    margin-bottom: 20px;
    border-bottom: 1px solid #e9ecef;
    padding-bottom: 15px;
    color: #333;
  }

  .services-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .services-list ul li {
    margin-bottom: 10px;
    border-bottom: 1px solid #f1f1f1;
    transition: all 0.3s ease;
  }

  .services-list ul li:last-child {
    border-bottom: none;
    margin-bottom: 0;
  }

  .services-list ul li a {
    padding: 10px 0;
    display: block;
    color: #555;
    font-size: 15px;
    transition: all 0.3s ease;
    position: relative;
    padding-left: 15px;
  }

  .services-list ul li a:before {
    content: "\f105";
    font-family: "FontAwesome";
    position: absolute;
    left: 0;
    top: 10px;
    color: #1720d7;
  }

  .services-list ul li a.active,
  .services-list ul li a:hover {
    color: #1720d7;
    font-weight: 600;
  }

  /* Enhanced style for active link */
  .services-list ul li a.active {
    color: #1720d7;
    font-weight: 700;
    background-color: rgba(23, 32, 215, 0.05);
    display: block;
    border-radius: 4px;
    padding-left: 15px;
  }

  .services-list ul li a.active:before {
    color: #1720d7;
    font-weight: bold;
  }

  /* Help box */
  .help-box {
    background-color: #1720d7;
    color: white;
    border-radius: 6px;
    padding: 30px;
    text-align: center;
  }

  .help-box h4 {
    font-size: 22px;
    margin-bottom: 15px;
    color: white;
  }

  .help-box p {
    margin-bottom: 20px;
    color: rgba(255, 255, 255, 0.9);
  }

  .help-box .theme-btn {
    background-color: white;
    color: #1720d7;
  }

  /* Service content */
  .service-detail {
    background-color: white;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    padding: 30px;
    margin-bottom: 30px;
    display: none; /* All services are hidden by default */
  }

  .service-detail.active {
    display: block; /* Only the active service is displayed */
  }

  .service-slogan {
    font-style: italic;
    color: #191a6d;
    font-size: 25px;
    font-weight: 400;
    margin-bottom: 20px;
    padding-left: 15px;
    border-left: 3px solid #1720d7;
  }

  .service-header {
    margin-bottom: 30px;
  }

  .service-image {
    margin-bottom: 30px;
    border-radius: 6px;
    overflow: hidden;
    width: 100%;
    aspect-ratio: 16 / 9; /* Choose your ratio (e.g.: 16:9, 4:3, 1:1, etc.) */
    background-color: #eee; /* Optional: background color during loading */
  }

  .service-image img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* or 'contain' if you want to show everything without crop */
    display: block;
  }

  .text-content {
    margin-bottom: 30px;
    color: #555;
    line-height: 1.7;
  }

  .text-content p {
    margin-bottom: 20px;
  }

  .text-content ul,
  .text-content ol {
    margin-bottom: 20px;
    padding-left: 20px;
  }

  .text-content li {
    margin-bottom: 10px;
  }

  .text-content strong {
    color: #333;
    font-weight: 600;
  }

  /* Service key points */
  .features-box {
    background-color: #f8f9fa;
    border-radius: 6px;
    padding: 25px;
    margin-bottom: 30px;
  }

  .features-box h3 {
    font-size: 18px;
    margin-bottom: 20px;
    color: #333;
  }

  .features-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
  }

  .feature-item {
    display: flex;
    align-items: center;
    padding: 10px;
    background-color: white;
    border-radius: 4px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  }

  .feature-item .icon {
    color: #1720d7;
    margin-right: 10px;
    font-size: 16px;
  }

  .feature-text {
    font-size: 14px;
    color: #333;
  }

  /* Action box */
  .action-box {
    text-align: center;
    margin-top: 30px;
  }

  /* Responsive */
  @media (max-width: 991px) {
    .service-detail {
      padding: 20px;
    }

    .features-list {
      grid-template-columns: 1fr;
    }
  }

  /* Scroll indicator animation */
  .service-detail.scrolling {
    animation: highlightContent 0.5s ease-in-out;
  }

  @keyframes highlightContent {
    0% {
      transform: scale(1);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    50% {
      transform: scale(1.01);
      box-shadow: 0 10px 30px rgba(23, 32, 215, 0.15);
    }
    100% {
      transform: scale(1);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
  }
</style>

<script>
  
  document.addEventListener("DOMContentLoaded", function () {
    const links = document.querySelectorAll(".service-link");
    const sections = document.querySelectorAll(".service-detail");

    // Function to scroll to content area with optimal positioning
    function scrollToContent(serviceId) {
      // Wait for the content to be visible first
      setTimeout(() => {
        const contentArea = document.getElementById("content-area");
        const activeService = document.getElementById(serviceId);
        
        if (contentArea && activeService) {
          // Calculate the optimal scroll position
          const headerHeight = 120; // Approximate header height with padding
          const contentRect = contentArea.getBoundingClientRect();
          const currentScroll = window.pageYOffset;
          
          // Calculate target scroll position to center the content nicely
          const targetPosition = currentScroll + contentRect.top - headerHeight;
          
          // Smooth scroll to the calculated position
          window.scrollTo({
            top: Math.max(0, targetPosition),
            behavior: 'smooth'
          });

          // Add highlighting animation
          activeService.classList.add('scrolling');
          setTimeout(() => {
            activeService.classList.remove('scrolling');
          }, 500);
        }
      }, 100); // Small delay to ensure content is rendered
    }

    // Function to display a specific service
    function showService(id) {
      // Check if ID exists
      const targetElement = document.getElementById(id);
      if (!targetElement) {
        console.warn(`Service with ID ${id} not found`);
        // Display the first service by default if the requested ID doesn't exist
        if (sections.length > 0) {
          const defaultId = sections[0].id;
          showService(defaultId);
        }
        return;
      }

      // Hide all services
      sections.forEach((section) => {
        section.classList.remove("active");
        section.style.display = "none";
      });

      // Show the requested service
      targetElement.classList.add("active");
      targetElement.style.display = "block";

      // Update active state of links
      links.forEach((link) => {
        link.classList.remove("active");
        // Get parent element (li)
        const parentLi = link.parentElement;
        parentLi.classList.remove("active-item");

        // Check if it's the active link
        const linkId = link.getAttribute("data-service-id");
        if (linkId === id) {
          link.classList.add("active");
          parentLi.classList.add("active-item");
        }
      });

      // Update URL without reloading page
      


      let previousScrollY = window.scrollY;

// Écouter l'événement popstate
window.addEventListener('popstate', function() {
  // Réinitialiser la position de défilement pour empêcher le défilement automatique
  window.scrollTo(0, previousScrollY);
});

// Fonction pour mettre à jour l'URL sans provoquer de défilement
function updateURLWithoutScroll(hash) {
  // Enregistrer la position de défilement actuelle
  previousScrollY = window.scrollY;

  // Mettre à jour l'URL sans provoquer de défilement
  history.pushState(null, '', hash);
}
      // Scroll to content for better visibility
      scrollToContent(id);

      // Update main menu links if present
      try {
        // Look for main menu links
        const mainMenuLinks = document.querySelectorAll(
          ".main-menu .navigation a"
        );
        mainMenuLinks.forEach((menuLink) => {
          const href = menuLink.getAttribute("href");
          if (href && href.includes(id)) {
            // Find the closest parent element with dropdown class
            let parentLi = menuLink.closest("li");

            // Add active class
            if (parentLi) {
              // First reset all links
              document
                .querySelectorAll(".main-menu .navigation li")
                .forEach((li) => {
                  if (li !== parentLi && !li.contains(parentLi)) {
                    li.classList.remove("current");
                  }
                });

              // Then add active class
              parentLi.classList.add("current");

              // If the link is in a submenu, also add class to parent
              const parentDropdown = parentLi.closest(".dropdown");
              if (parentDropdown) {
                parentDropdown.classList.add("current");
              }
            }
          }
        });
      } catch (e) {
        console.warn("Navigation menu links not found or error occurred", e);
      }
    }

    // Add event listeners to links
    links.forEach((link) => {
      link.addEventListener("click", function (e) {
        e.preventDefault();
        const id = this.getAttribute("data-service-id");
        showService(id);
      });
    });
    

    // Handle hash changes in URL
    window.addEventListener("hashchange", function () {
      const hash = window.location.hash.substring(1);
      if (hash) {
        showService(hash);
      }
    });

    // Initialization: show service corresponding to hash or first service
    const hash = window.location.hash.substring(1);
    if (hash) {
      showService(hash);
    } else if (sections.length > 0) {
      showService(sections[0].id);
    }

    // Enhancement: update header links if matching with services
    // This allows maintaining synchronization between both menus
    function updateHeaderLinks() {
      const currentHash = window.location.hash.substring(1);
      if (!currentHash) return;

      try {
        // Find all main menu links that can contain service IDs
        const headerMenuLinks = document.querySelectorAll(
          ".main-menu .navigation a"
        );

        headerMenuLinks.forEach((link) => {
          const href = link.getAttribute("href");
          if (href && href.includes(currentHash)) {
            // Add 'current' class to parent li element
            const parentLi = link.closest("li");
            if (parentLi) {
              parentLi.classList.add("current");

              // If parent is in a dropdown, also mark the dropdown
              const parentDropdown = parentLi.closest(".dropdown");
              if (parentDropdown && parentDropdown !== parentLi) {
                parentDropdown.classList.add("current");
              }
            }
          }
        });
      } catch (e) {
        console.warn("Error updating header links", e);
      }
    }

    // Call this function on initial load
    updateHeaderLinks();

    // Test if header exists and contains expected elements
    const header = document.querySelector(".main-header");
    if (header) {
      console.log("Header found, menu synchronization enabled");
    }

    // Handle external links that come with hash (from other pages)
    window.addEventListener("load", function() {
      if (window.location.hash) {
        // Small delay to ensure page is fully loaded
        setTimeout(() => {
          const hash = window.location.hash.substring(1);
          if (hash) {
            showService(hash);
          }
        }, 500);
      }
    });

    // Handle smooth scrolling for mobile devices
    function isMobileDevice() {
      return window.innerWidth <= 991;
    }

    // Override scroll behavior for mobile to account for smaller screen
    function mobileScrollToContent(serviceId) {
      if (isMobileDevice()) {
        setTimeout(() => {
          const servicesSection = document.getElementById("services-main-section");
          if (servicesSection) {
            const headerHeight = 80; // Smaller header on mobile
            const sectionRect = servicesSection.getBoundingClientRect();
            const currentScroll = window.pageYOffset;
            const targetPosition = currentScroll + sectionRect.top - headerHeight;
            
            window.scrollTo({
              top: Math.max(0, targetPosition),
              behavior: 'smooth'
            });
          }
        }, 150);
      }
    }

    // Add mobile scroll handling to the showService function
    const originalShowService = showService;
    showService = function(id) {
      originalShowService(id);
      if (isMobileDevice()) {
        mobileScrollToContent(id);
      }
    };

    // Handle window resize to adjust scroll behavior
    window.addEventListener("resize", function() {
      // Recalculate positions on resize
      const currentHash = window.location.hash.substring(1);
      if (currentHash) {
        setTimeout(() => {
          scrollToContent(currentHash);
        }, 100);
      }
    });
  });
</script>